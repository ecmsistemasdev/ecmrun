<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/css/pagamento.css"/>
    <title>Pagamento PIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <div id="payment-modal-root"></div>
    </head>
<body>
    <div class="logo-container">
        <img src="https://ecmrun.com.br/static/img/ecmrunlogo1.png" alt="Logo" class="logo">
        <h1 class="header-title">Pagamento via PIX</h1>
    </div>

    <div class="payment-container" id="pixForm">
        <div class="payment-info">
            <div>Valor total a pagar:</div>
            <div class="total-amount" id="totalAmount">Carregando...</div>
            <div class="payment-status">
                <i class="bi bi-exclamation-circle"></i>
                Atenção! Não feche esta página até realizar o pagamento. Você será redirecionado para a confirmação da inscrição.
            </div>
        </div>

        <input type="hidden" id="persistentPaymentId" class="persistent-data">

        <div id="loadingContainer" class="qr-container">
            <div class="spinner"></div>
            <p>Gerando QR Code PIX...</p>
        </div>

        <div id="qrContainer" class="qr-container hidden">
            <h3>QR Code PIX</h3>
            <img alt="QR Code PIX" class="qr-code" id="qrCode">

            <!-- <div class="pix-key-container">
                <div>Chave PIX:</div>
                <div class="pix-key" id="pixKey"></div>
                <button class="button" onclick="copyPixKey()">Copiar Chave PIX</button>
            </div> -->

            <div class="pix-key-container">
                <div>Chave PIX:</div>
                <div class="pix-key" id="pixKey"></div>
                <button class="button" onclick="copyPixKey()">Copiar Chave PIX</button>
                <!-- NOVO BOTÃO ADICIONADO AQUI -->
                <button class="button primary" onclick="confirmarPagamento()" id="confirmPaymentBtn">
                    <span id="confirmBtnText">Confirmar Pagamento</span>
                    <span id="confirmBtnSpinner" class="spinner-small" style="display: none;"></span>
                </button>
            </div>

        </div>

        <div class="button-container">
            <button class="button secondary" onclick="voltarParaEvento()">Voltar</button>
        </div>

        <!-- <div class="button-container">
             <button class="button secondary" onclick="window.history.back()">Voltar</button>
        </div> -->
    </div>

    <div id="paymentModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Status do Pagamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <div id="loadingPayment">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Verificando pagamento...</span>
                            </div>
                            <p class="mt-2">Verificando o status do pagamento...</p>
                        </div>
                        <div id="paymentSuccess" style="display: none;">
                            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                            <h4 class="mt-3">Pagamento Confirmado!</h4>
                            <p>Sua inscrição foi realizada com sucesso.</p>
                        </div>
                        <div id="paymentPending" style="display: none;">
                            <i class="bi bi-clock-fill text-warning" style="font-size: 3rem;"></i>
                            <h4 class="mt-3">Pagamento Pendente</h4>
                            <p>Aguardando a confirmação do seu pagamento...</p>
                        </div>
                        <div id="paymentError" style="display: none;">
                            <i class="bi bi-x-circle-fill text-danger" style="font-size: 3rem;"></i>
                            <h4 class="mt-3">Erro no Pagamento</h4>
                            <p>Houve um problema ao processar seu pagamento.</p>
                        </div>
                    </div>
                </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>

    <div class="cartoes" align="center">
        <div>
            <img src="https://ecmrun.com.br/static/img/seloseguro.png" style="width:60%; margin-top: 3px;">
        </div>
    </div>

    <footer class="footer">
        <p class="bible-verse">"Tudo posso naquele que me fortalece." - Filipenses 4:13</p>
        <img src="/static/img/ecmdev02.png" alt="Logo ECM Run" class="footer-logo">
        <p class="footer-text">ECM RUN Esports - todos os direitos reservados</p>
        <p class="footer-text">Desenvolvido por: ECM Sistemas Developer</p>
    </footer>

    <script src="/static/js/pagamento.js"></script>
</body>
</html>