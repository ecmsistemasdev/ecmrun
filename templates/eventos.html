<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/css/eventos.css"/>
    <title>Sistema de Eventos</title>
</head>
<body>
    <div class="container">
        <!-- Tela de Login -->
        <div id="authScreen">
            <div class="auth-container">
                <form id="authForm" class="auth-form">
                    <img src="https://ecmrun.com.br/static/img/ecmrunlogo1.png" alt="Logo" class="logo" style="margin-bottom: 20px;">
                    <h2>Acesso Restrito</h2>
                    <div class="form-group">
                        <input type="password" id="senha" placeholder="Digite a senha" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
                </form>
            </div>
        </div>

        <!-- Tela Principal -->
        <div id="mainScreen" class="hidden">
            <div class="header">
                <img src="https://ecmrun.com.br/static/img/ecmrunlogo1.png" alt="Logo" class="logo">
                <h1>Sistema de Eventos</h1>
                <button type="button" class="btn btn-secondary" onclick="logout()">Sair</button>
            </div>

            <div id="messages"></div>

            <!-- Lista de Eventos -->
            <div id="eventsListScreen">
                <div class="events-list">
                    <div class="events-header">
                        <h2>Meus Eventos</h2>
                        <button type="button" class="btn btn-success" onclick="showCreateForm()">
                            + Novo Evento
                        </button>
                    </div>
                    <div id="eventsList">
                        <!-- Lista será carregada via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Formulário de Evento -->
            <div id="eventFormScreen" class="hidden">
                <div class="back-btn">
                    <button type="button" class="btn btn-secondary" onclick="showEventsList()">
                        ← Voltar para Lista
                    </button>
                </div>

                <form id="eventoForm" class="main-form">
                    <h2 id="formTitle">Novo Evento</h2>
                    <input type="hidden" id="eventoId" name="eventoId">
                    
                    <div class="form-group">
                        <label for="titulo">Título do Evento *</label>
                        <input type="text" id="titulo" name="titulo" required maxlength="80">
                    </div>

                    <div class="form-group">
                        <label for="subtitulo">Subtítulo</label>
                        <input type="text" id="subtitulo" name="subtitulo" maxlength="100">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="datainicio">Data de Início *</label>
                            <input type="date" id="datainicio" name="datainicio" required>
                        </div>
                        <div class="form-group">
                            <label for="datafim">Data de Fim *</label>
                            <input type="date" id="datafim" name="datafim" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="hrinicio">Horário de Início</label>
                        <input type="time" id="hrinicio" name="hrinicio">
                    </div>

                    <div class="form-group">
                        <label for="dslink">Link do Evento (apenas letras, números e hífen) *</label>
                        <input type="text" id="dslink" name="dslink" required maxlength="25" placeholder="ex: meu-evento-2024">
                        <small style="color: #666; font-size: 14px;">Este será seu link: www.ecmrun.com.br/evento/<span id="linkPreview"></span></small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="inicioinscricao">Início das Inscrições</label>
                            <input type="date" id="inicioinscricao" name="inicioinscricao">
                        </div>
                        <div class="form-group">
                            <label for="fiminscricao">Fim das Inscrições</label>
                            <input type="date" id="fiminscricao" name="fiminscricao">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="endereco">Endereço</label>
                        <input type="text" id="endereco" name="endereco" maxlength="100">
                    </div>

                    <div class="form-group">
                        <label for="cidadeuf">Cidade/UF</label>
                        <input type="text" id="cidadeuf" name="cidadeuf" maxlength="80">
                    </div>

                    <div class="editor-buttons">
                        <button type="button" class="btn btn-secondary" onclick="openModal('descricaoModal')">
                            Editar Descrição
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="openModal('regulamentoModal')">
                            Editar Regulamento
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="openModal('lotesModal')">
                            Itens/Lotes
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="abrirImagensSeguro()">
                            Imagens do Evento
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="banner">Banner/Imagem do Evento</label>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <input type="file" id="bannerFile" accept="image/*" onchange="handleBannerUpload(event)">
                            <div id="bannerPreview" style="display: none;">
                                <img id="bannerImage" src="" alt="Preview do banner" style="max-height: 200px; width: 100%; object-fit: contain; border: 2px solid #ddd; border-radius: 8px;">
                                <button type="button" class="btn btn-danger btn-sm" onclick="removeBanner()" style="margin-top: 10px;">Remover Banner</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="obs">Observações</label>
                        <textarea id="obs" name="obs" rows="3" maxlength="200"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-success" id="submitBtn">Salvar Evento</button>
                        <button type="button" class="btn btn-secondary" onclick="showEventsList()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Descrição -->
    <div id="descricaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Descrição do Evento</h2>
                <span class="close" onclick="closeModal('descricaoModal')">&times;</span>
            </div>
            <div class="editor-container">
                <div class="editor-toolbar">
                    <button type="button" class="toolbar-btn" onclick="formatText('bold')"><b>B</b></button>
                    <button type="button" class="toolbar-btn" onclick="formatText('italic')"><i>I</i></button>
                    <button type="button" class="toolbar-btn" onclick="formatText('underline')"><u>U</u></button>
                    <select onchange="formatText('fontName', this.value)" class="toolbar-btn">
                        <option value="">Fonte</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                    </select>
                    <select onchange="formatText('fontSize', this.value)" class="toolbar-btn">
                        <option value="">Tamanho</option>
                        <option value="1">8pt</option>
                        <option value="2">10pt</option>
                        <option value="3">12pt</option>
                        <option value="4">14pt</option>
                        <option value="5">18pt</option>
                        <option value="6">24pt</option>
                        <option value="7">36pt</option>
                    </select>
                    <input type="color" class="color-picker" onchange="formatText('foreColor', this.value)" title="Cor do texto">
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyLeft')">←</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyCenter')">↔</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyRight')">→</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')">• Lista</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('insertOrderedList')">1. Lista</button>
                </div>
                <div id="descricaoEditor" class="editor-content" contenteditable="true" 
                     placeholder="Digite a descrição do evento aqui..."></div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-success" onclick="saveEditor('descricao')">Salvar</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('descricaoModal')">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Regulamento -->
    <div id="regulamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Regulamento do Evento</h2>
                <span class="close" onclick="closeModal('regulamentoModal')">&times;</span>
            </div>
            <div class="editor-container">
                <div class="editor-toolbar">
                    <button type="button" class="toolbar-btn" onclick="formatText('bold')"><b>B</b></button>
                    <button type="button" class="toolbar-btn" onclick="formatText('italic')"><i>I</i></button>
                    <button type="button" class="toolbar-btn" onclick="formatText('underline')"><u>U</u></button>
                    <select onchange="formatText('fontName', this.value)" class="toolbar-btn">
                        <option value="">Fonte</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                    </select>
                    <select onchange="formatText('fontSize', this.value)" class="toolbar-btn">
                        <option value="">Tamanho</option>
                        <option value="1">8pt</option>
                        <option value="2">10pt</option>
                        <option value="3">12pt</option>
                        <option value="4">14pt</option>
                        <option value="5">18pt</option>
                        <option value="6">24pt</option>
                        <option value="7">36pt</option>
                    </select>
                    <input type="color" class="color-picker" onchange="formatText('foreColor', this.value)" title="Cor do texto">
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyLeft')">←</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyCenter')">↔</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('justifyRight')">→</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')">• Lista</button>
                    <button type="button" class="toolbar-btn" onclick="formatText('insertOrderedList')">1. Lista</button>
                </div>
                <div id="regulamentoEditor" class="editor-content" contenteditable="true" 
                     placeholder="Digite o regulamento do evento aqui..."></div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-success" onclick="saveEditor('regulamento')">Salvar</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('regulamentoModal')">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Itens/Lotes -->
    <div id="lotesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Itens e Lotes do Evento</h2>
                <span class="close" onclick="closeModal('lotesModal')">&times;</span>
            </div>
            
            <div id="lotesContent">
                <!-- Lista de itens existentes -->
                <div id="itensExistentes" class="hidden">
                    <div class="events-header">
                        <h3>Itens Cadastrados</h3>
                        <button type="button" class="btn btn-success btn-sm" onclick="showAddItemForm()">
                            + Adicionar Item
                        </button>
                    </div>
                    <div id="itensLista"></div>
                </div>
                
                <!-- Formulário para adicionar/editar item -->
        <div id="itemForm" class="hidden">
            <h3 id="itemFormTitle">Adicionar Item</h3>
            <form id="itemFormData">
                <input type="hidden" id="editingItemId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="itemDescricao">Descrição *</label>
                        <input type="text" id="itemDescricao" maxlength="25" required placeholder="Ex: Corrida 5K">
                    </div>
                    <div class="form-group">
                        <label for="itemKm">KM *</label>
                        <input type="number" id="itemKm" step="0.01" min="0" required placeholder="5.00">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-success" onclick="salvarItem()">Salvar Item</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelarItem()">Cancelar</button>
                </div>
            </form>
        </div>
                
                <!-- Formulário para gerenciar lotes de um item -->
                <div id="lotesForm" class="hidden">
                    <div class="back-btn">
                        <button type="button" class="btn btn-secondary" onclick="voltarParaItens()">
                            ← Voltar para Itens
                        </button>
                    </div>
                    <h3 id="lotesFormTitle">Gerenciar Lotes</h3>
                    <div id="lotesItemInfo" class="lote-item" style="background: #e3f2fd; margin-bottom: 20px;">
                        <!-- Info do item será preenchida dinamicamente -->
                    </div>
                    
                    <!-- Lista de lotes do item -->
                    <div id="lotesDoItem"></div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-success" onclick="adicionarLoteParaItem()">+ Adicionar Lote</button>
                    </div>
                    
                    <!-- Formulário de lote -->
                    <div id="loteFormContainer" class="hidden">
                        <div class="lote-inputs">
                            <input type="hidden" id="editingLoteId">
                            
                            <div class="form-group">
                                <label>Valor Inscrição *</label>
                                <input type="number" id="loteVlinscricao" step="0.01" min="0" required onchange="calcularTaxaLote()">
                            </div>
                            
                            <div class="form-group">
                                <label>Taxa (%)</label>
                                <input type="text" id="lotePctaxa" readonly style="background: #f8f9fa;">
                            </div>
                            
                            <div class="form-group">  <!-- ← ADICIONAR ESTE CAMPO AQUI -->
                                <label>Nº Atletas *</label>
                                <input type="number" id="loteNuatletas" min="0" required placeholder="100">
                            </div>
                            
                            <div class="form-group">
                                <label>Data Início</label>
                                <input type="date" id="loteDtinicio">
                            </div>
                            
                            <div class="form-group">
                                <label>Data Fim</label>
                                <input type="date" id="loteDtfim">
                            </div>
                            
                            <div class="form-group">
                                <label>Lote *</label>
                                <input type="number" id="loteLote" min="1" required onchange="atualizarDescricaoLoteAtual()">
                            </div>
                            
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>Descrição do Lote</label>
                                <input type="text" id="loteDelote" maxlength="25">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-success" onclick="salvarLote()">Salvar Lote</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelarLote()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Imagens do Evento -->
    <div id="imagensModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Imagens do Evento</h2>
                <span class="close" onclick="closeModal('imagensModal')">&times;</span>
            </div>
            
            <div id="imagensContent">
                <!-- Lista de imagens existentes -->
                <div id="imagensExistentes" class="hidden">
                    <div class="events-header">
                        <h3>Imagens Cadastradas</h3>
                        <button type="button" class="btn btn-success btn-sm" onclick="showAddImageForm()">
                            + Adicionar Imagem
                        </button>
                    </div>
                    <div id="imagensLista"></div>
                </div>
                
                <!-- Formulário para adicionar/editar imagem -->
                <div id="imageForm" class="hidden">
                    <h3 id="imageFormTitle">Adicionar Imagem</h3>
                    <form id="imageFormData">
                        <input type="hidden" id="editingImageId">
                        
                        <div class="form-group">
                            <label for="imageTitulo">Título da Imagem *</label>
                            <input type="text" id="imageTitulo" maxlength="45" required placeholder="Ex: Vista aérea da largada">
                        </div>
                        
                        <div class="form-group">
                            <label for="imageFile">Arquivo da Imagem *</label>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <input type="file" id="imageFile" accept="image/*" onchange="handleImageUpload(event)" required>
                                <div id="imagePreview" style="display: none;">
                                    <img id="imagePreviewImg" src="" alt="Preview da imagem" style="max-height: 200px; width: 100%; object-fit: contain; border: 2px solid #ddd; border-radius: 8px;">
                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeImagePreview()" style="margin-top: 10px;">Remover Imagem</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-success" onclick="salvarImagem()">Salvar Imagem</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelarImagem()">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Mensagens -->
    <div id="messageModal" class="message-modal">
        <div class="message-modal-content">
            <div class="message-modal-header">
                <div id="messageIcon" class="message-modal-icon">
                    <span id="messageIconText">✓</span>
                </div>
                <h3 id="messageTitle" class="message-modal-title">Sucesso</h3>
                <p id="messageText" class="message-modal-text">Operação realizada com sucesso!</p>
            </div>
            <div class="message-modal-footer">
                <button id="messageButton" class="message-modal-button" onclick="closeMessageModal()">OK</button>
            </div>
        </div>
    </div>    
    
    <script src="/static/js/eventos.js"></script>

</body>
</html>
